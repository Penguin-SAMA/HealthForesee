# 银发守护 - 接口文档（详细版）

## 1. 概述
本接口文档覆盖银发守护系统初版的全部核心接口，包括：

- 登录认证
- 用户资料与角色管理
- 家庭（父母-子女）绑定
- 健康看板（子女端）
- 一键挂号流程（推荐与跳转）

统一返回格式如下：

```
{
  "code": 0,
  "message": "ok",
  "data": {...}
}
```

所有需要鉴权的接口需携带：

`Authorization: Bearer {token}`

---

## 2. 认证模块接口

### 2.1 发送验证码  
**POST** `/auth/send-code`

**请求：**
```json
{
  "phone": "13800000000",
  "scene": "login"
}
```

**响应：**
```json
{
  "code": 0,
  "data": { "nextSendInterval": 60 }
}
```

### 2.2 登录（验证码）  
**POST** `/auth/login`

**请求：**
```json
{
  "phone": "13800000000",
  "code": "123456",
  "deviceInfo": {
    "platform": "ios",
    "deviceId": "xxxx",
    "appVersion": "1.0.0"
  }
}
```

**响应：**
```json
{
  "code": 0,
  "data": {
    "token": "xxx",
    "user": {
      "userId": "u_123",
      "name": "张三",
      "role": "CHILD"
    }
  }
}
```

---

## 3. 用户资料接口

### 3.1 更新个人资料  
**PUT** `/user/profile`

**请求：**
```json
{
  "name": "张三",
  "role": "CHILD",
  "gender": "MALE",
  "birthday": "1985-01-01",
  "idNumberLast4": "1234"
}
```

**响应：**
```json
{
  "code": 0,
  "data": { "userId": "u_123" }
}
```

---

## 4. 家庭绑定接口（父母-子女互联）

### 4.1 获取家庭成员列表  
**GET** `/family/members`

**响应：**
```json
{
  "code": 0,
  "data": {
    "members": [
      {
        "relationId": "rel_001",
        "userId": "u_parent_1",
        "name": "李大爷",
        "role": "PARENT",
        "relation": "FATHER",
        "status": "ACTIVE"
      }
    ]
  }
}
```

### 4.2 子女通过手机号邀请父母  
**POST** `/family/invite`

**请求：**
```json
{
  "inviteePhone": "13900000000",
  "relation": "FATHER"
}
```

**响应：**
```json
{
  "code": 0,
  "data": { "inviteId": "inv_123" }
}
```

### 4.3 父母查看待处理邀请  
**GET** `/family/invites/pending`

### 4.4 父母处理邀请（同意/拒绝）  
**POST** `/family/invites/{inviteId}/decision`

**请求：**
```json
{ "decision": "ACCEPT" }
```

### 4.5 父母生成绑定二维码  
**POST** `/family/invite-qrcode`

**响应：**
```json
{
  "code": 0,
  "data": {
    "qrToken": "qr_xxxx",
    "expireAt": "2025-11-12T10:00:00Z"
  }
}
```

### 4.6 子女扫码绑定父母  
**POST** `/family/invite-by-token`

**请求：**
```json
{ "qrToken": "qr_xxxx" }
```

---

## 5. 子女端健康看板接口

### 5.1 子女首页看板  
**GET** `/dashboard/children`

### 5.2 单个父母健康详情  
**GET** `/parents/{parentUserId}/overview`

---

## 6. 一键挂号接口（推荐 + 跳转）

### 6.1 获取医院与科室推荐  
**POST** `/appointments/recommendations`

**请求：**
```json
{
  "patientUserId": "u_parent_1",
  "symptomText": "胸闷、心悸",
  "cityCode": "310000"
}
```

### 6.2 创建一键挂号记录并获取跳转链接  
**POST** `/appointments/quick`

**请求：**
```json
{
  "patientUserId": "u_parent_1",
  "hospitalId": "h_001",
  "departmentId": "d_cardio",
  "symptomText": "胸闷、心悸",
  "preferredDate": "2025-11-12",
  "timePreference": "MORNING"
}
```

### 6.3 获取挂号详情  
**GET** `/appointments/{appointmentId}`

### 6.4 获取挂号记录列表  
**GET** `/appointments?patientUserId=xxx`
